---
phase: 02.4-cli-polish-testing
plan: 01
subsystem: cli
tags: [cli, config-discovery, campaign-grouping, ux]

dependency-graph:
  requires: []
  provides: [config-list-command, campaign-grouping]
  affects: [02.4-03, 02.4-04]

tech-stack:
  added: []
  patterns: [dynamic-table-columns, field-extraction]

key-files:
  created: []
  modified:
    - src/llenergymeasure/cli/config.py
    - src/llenergymeasure/cli/campaign.py
    - src/llenergymeasure/results/aggregation.py

decisions:
  - name: campaign-configs-filtered
    description: Campaign YAML files (with campaign_name key) are excluded from config list to avoid confusion

metrics:
  duration: 5 min
  completed: 2026-02-04
---

# Phase 2.4 Plan 01: Config List and Campaign Grouping Summary

**One-liner:** Added `lem config list` command for config discoverability and `--group-by` flag for flexible campaign result aggregation.

## What Was Built

### Task 1: `lem config list` Command

Added new command to the config subgroup that scans directories for YAML configurations:

```bash
lem config list              # List configs in configs/
lem config list -d /path     # Custom directory
lem config list -u           # Also show .lem-config.yaml settings
```

Features:
- Recursive scan of directory for `**/*.yaml` files
- Rich table output with Name, Backend, Model, Path columns
- Extracts `config_name`, `backend`, `model_name` from each YAML
- Gracefully skips invalid YAML or non-config files
- Campaign configs (with `campaign_name` key) are filtered out
- Model names truncated to 40 characters for display
- Optional `--show-user-config` displays `.lem-config.yaml` settings

### Task 2: Campaign `--group-by` Flag

Added flexible result grouping for campaign CI summary:

```bash
lem campaign configs/*.yaml --group-by backend
lem campaign configs/*.yaml --group-by backend,batch_size
lem campaign configs/*.yaml --group-by pytorch.batch_size
```

Features:
- `aggregate_campaign_with_grouping()` function in `aggregation.py`
- `_extract_field_value()` helper for dot-notation field access
- Supports top-level fields: `backend`, `model_name`, `config_name`
- Supports nested paths: `pytorch.batch_size`, `vllm.max_num_seqs`
- Dynamic table columns based on group fields
- Bootstrap CIs computed per group

## Architecture

```
CLI campaign command
        |
        v
parse --group-by "backend,batch_size"
        |
        v
group_by_fields = ["backend", "batch_size"]
        |
        v
_display_campaign_ci_summary(manifest, campaign, group_by_fields)
        |
        +-- if group_by: aggregate_campaign_with_grouping()
        +-- else:        aggregate_campaign_results() (default)
        |
        v
Dynamic Rich table with group columns + metric columns
```

## Commits

| Hash | Description |
|------|-------------|
| f33cd21 | feat(02.4-01): add lem config list command |
| 42c8d82 | feat(02.4-01): add --group-by flag for campaign result grouping |

## Deviations from Plan

None - plan executed exactly as written.

## Verification

All verification checks passed:

```
lem config list                    # Shows table of available configs
lem config list -d configs/examples  # Shows 3 example configs
lem config list --show-user-config   # Shows user config settings
lem campaign --help | grep group-by  # Shows --group-by option
lem campaign ... --group-by backend --dry-run  # Shows grouped execution plan
```

## Next Phase Readiness

Ready for Plan 02.4-02 (Schema Version and Example Configs) - no blockers.
