---
phase: 02.4-cli-polish-testing
plan: 03
subsystem: testing
tags: [smoke-test, warning-capture, ssot, runtime-testing]

# Dependency graph
requires:
  - phase: 02.4-cli-polish-testing
    provides: Existing smoke test infrastructure in test_all_params.py
provides:
  - Comprehensive warning/error capture in smoke tests
  - CapturedIssue dataclass for categorising output issues
  - extract_all_issues() function for comprehensive pattern matching
  - --smoke flag for strict mode (fail on ANY issue)
  - issues.yaml known issue tracking
affects: [test-runtime, ci-pipeline, future-backend-testing]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Comprehensive capture, filter known issues later"
    - "issues.yaml for WIP/external issue tracking"

key-files:
  created:
    - tests/runtime/issues.yaml
  modified:
    - tests/runtime/test_all_params.py

key-decisions:
  - "Capture-first philosophy: capture ALL warnings/errors, filter known issues via issues.yaml"
  - "Issue sources auto-detected from message content (vllm, torch, transformers, etc.)"
  - "Status values for known issues: wip, wontfix, external"

patterns-established:
  - "CapturedIssue dataclass: category, source, message, severity"
  - "Known issues tracked in YAML with pattern regex matching"

# Metrics
duration: 5min
completed: 2026-02-04
---

# Phase 2.4 Plan 3: Smoke Test Warning Capture Summary

**Comprehensive warning/error capture in smoke tests with --smoke strict mode and issues.yaml for tracking known issues**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-04T12:05:53Z
- **Completed:** 2026-02-04T12:11:07Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Added CapturedIssue dataclass and extract_all_issues() for comprehensive output capture
- Added --smoke flag for strict mode that fails on ANY warning or error
- Created issues.yaml for tracking known issues (WIP, external, wontfix)
- Updated TestResult and TestReport with captured issues and issues_by_source
- Updated print_summary() to display issues by source library

## Task Commits

Each task was committed atomically:

1. **Task 1: Add comprehensive warning/error capture** - `b9c7b79` (feat)
2. **Task 2: Create issues.yaml** - `9ea8738` (feat)

## Files Created/Modified
- `tests/runtime/test_all_params.py` - Added CapturedIssue, extract_all_issues(), --smoke flag, issues_by_source reporting
- `tests/runtime/issues.yaml` - Known issues tracking with pattern matching

## Decisions Made
- Capture-first philosophy: capture ALL warnings/errors comprehensively, filter known issues later via issues.yaml pattern matching
- Issue sources auto-detected from message content (vllm, torch, transformers, tensorrt, flash_attention, unknown)
- Status values for known issues: wip (we're fixing), wontfix (can't/won't fix), external (upstream dependency)
- Fixed load_known_issues() to handle None when known_issues key exists but has no entries

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
- load_known_issues() returned None when known_issues YAML key had no entries (all commented). Fixed by using `data.get("known_issues") or {}` instead of `data.get("known_issues", {})`.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Smoke test infrastructure now captures all warnings/errors
- Ready for actual runtime testing with --smoke flag
- issues.yaml prepared for tracking known issues as they are discovered

---
*Phase: 02.4-cli-polish-testing*
*Completed: 2026-02-04*
