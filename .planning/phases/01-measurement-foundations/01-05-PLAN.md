---
phase: 01-measurement-foundations
plan: 05
type: gap_closure
wave: 3
depends_on:
  - 01-03
files_modified:
  - src/llenergymeasure/state/__init__.py
autonomous: true
requirements:
  - INF-07
  - INF-08

must_haves:
  truths:
    - "from llenergymeasure.state import ExperimentState, StateManager succeeds without error"
    - "state/__init__.py imports from llenergymeasure.core.state, not the deleted state/experiment_state.py"
    - "v1.x names (ExperimentStatus, ProcessProgress, ProcessStatus) are not re-exported — they do not exist in v2.0"
    - "No cli/ files are modified — only state/__init__.py is updated"
  artifacts:
    - path: "src/llenergymeasure/state/__init__.py"
      provides: "Redirect from old state package to new core/state.py location"
      contains: "from llenergymeasure.core.state import"
  key_links:
    - from: "src/llenergymeasure/state/__init__.py"
      to: "src/llenergymeasure/core/state.py"
      via: "re-exports ExperimentState, StateManager, ExperimentPhase, compute_config_hash"
      pattern: "from llenergymeasure\\.core\\.state import"
---

<objective>
Update state/__init__.py to import from the new core/state.py module instead of the
deleted state/experiment_state.py. This makes `from llenergymeasure.state import ...`
work as a redirect to core/state.py.

Purpose: Closes Phase 1 verification gap #2 — the broken state module redirect. v1.x
CLI files that import from llenergymeasure.state will resolve via this redirect without
needing to be modified (they are Phase 7 scope).

Note: cli/experiment.py, cli/utils.py, and cli/display/summaries.py also import directly
from `llenergymeasure.state.experiment_state` (the deleted file path). This plan does NOT
fix those — they import from the specific submodule path, not from the package __init__.
Those files will be rewritten in their respective later phases. The TYPE_CHECKING imports
in cli/utils.py and cli/display/summaries.py are safe (never executed at runtime).
The runtime import in cli/utils.py line 119 (`ProcessProgress, ProcessStatus`) will
still fail if that code path is hit, but those types do not exist in v2.0 and that
function will be rewritten in Phase 7.
</objective>

<execution_context>
@/home/h.baker@hertie-school.lan/.claude/get-shit-done/workflows/execute-plan.md
@/home/h.baker@hertie-school.lan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-measurement-foundations/01-VERIFICATION.md
@src/llenergymeasure/state/__init__.py
@src/llenergymeasure/core/state.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update state/__init__.py to redirect to core/state.py</name>
  <files>src/llenergymeasure/state/__init__.py</files>
  <action>
Rewrite state/__init__.py to redirect imports to the new core/state.py location.

Replace the entire file content with:

```python
"""State management for llenergymeasure experiments.

This package redirects to llenergymeasure.core.state, which is the canonical
location since v2.0. Direct imports from this package are supported for
backwards compatibility.
"""

from llenergymeasure.core.state import (
    ExperimentPhase,
    ExperimentState,
    StateManager,
    compute_config_hash,
)

__all__ = [
    "ExperimentPhase",
    "ExperimentState",
    "StateManager",
    "compute_config_hash",
]
```

Do NOT re-export v1.x names that no longer exist (ExperimentStatus, ProcessProgress,
ProcessStatus). These types were part of the 6-state v1.x machine and have no v2.0
equivalent. Code that references them will fail at the import site, which is correct —
those files are rewritten in later phases.

Also delete `src/llenergymeasure/state/CLAUDE.md` if it exists — it describes the
v1.x 6-state machine and is now misleading. The canonical docs are in core/state.py's
module docstring.
  </action>
  <verify>
Run: `python -c "
from llenergymeasure.state import ExperimentState, StateManager, ExperimentPhase, compute_config_hash
assert ExperimentPhase.INITIALISING.value == 'initialising'
s = ExperimentState(experiment_id='test')
assert s.phase == ExperimentPhase.INITIALISING
print('state redirect works')
"` — prints message.
  </verify>
  <done>
state/__init__.py redirects to core/state.py. `from llenergymeasure.state import ExperimentState`
resolves correctly. Stale CLAUDE.md removed. v1.x types (ExperimentStatus, ProcessProgress,
ProcessStatus) are intentionally not re-exported.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from llenergymeasure.state import ExperimentState, StateManager, ExperimentPhase; print('OK')"` — prints OK
2. `python -c "from llenergymeasure.state import compute_config_hash; print('OK')"` — prints OK
3. `grep -c 'experiment_state' src/llenergymeasure/state/__init__.py` — returns 0 (no reference to deleted module)
</verification>

<success_criteria>
- `from llenergymeasure.state import ExperimentState, StateManager` works without error
- state/__init__.py references core.state, not the deleted experiment_state.py
- Stale CLAUDE.md in state/ is removed
- No cli/ files are modified
</success_criteria>

<output>
After completion, create `.planning/phases/01-measurement-foundations/01-05-SUMMARY.md`
</output>
