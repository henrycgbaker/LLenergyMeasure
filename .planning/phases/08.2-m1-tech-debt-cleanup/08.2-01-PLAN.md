---
phase: 08.2-m1-tech-debt-cleanup
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/02-config-system/02-VERIFICATION.md
  - .planning/REQUIREMENTS.md
  - src/llenergymeasure/cli/CLAUDE.md
autonomous: true
requirements: [CFG-01, CFG-02, CFG-03, CFG-04, CFG-05, CFG-06, CFG-07, CFG-08, CFG-09, CFG-10, CFG-18, CFG-19, CFG-20, CFG-21, CFG-22, CFG-23, CFG-24, CFG-25, CFG-26]
must_haves:
  truths:
    - "Phase 2 has a VERIFICATION.md confirming all 19 CFG requirements (CFG-01 through CFG-10, CFG-18 through CFG-26)"
    - "REQUIREMENTS.md traceability table shows CFG-01–10 and CFG-18–26 as Complete (not Pending)"
    - "cli/CLAUDE.md accurately reflects the v2.0 CLI structure (no references to deleted batch, schedule, or listing commands)"
  artifacts:
    - path: ".planning/phases/02-config-system/02-VERIFICATION.md"
      provides: "Formal verification of all 19 CFG requirements for Phase 2"
      contains: "status: passed"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Updated traceability with CFG requirements marked Complete"
      contains: "Complete"
    - path: "src/llenergymeasure/cli/CLAUDE.md"
      provides: "Accurate v2.0 CLI documentation"
  key_links:
    - from: "02-VERIFICATION.md"
      to: "02-UAT.md + 02-0N-SUMMARY.md frontmatter"
      via: "Evidence references from UAT test results and SUMMARY requirements-completed lists"
---

# Phase 8.2 Plan 01: Documentation Cleanup

## Objective

Write the missing Phase 2 VERIFICATION.md (19 CFG requirements), update the REQUIREMENTS.md traceability table from Pending to Complete, and correct `cli/CLAUDE.md` to reflect the v2.0 CLI structure.

## Context

The M1 audit found three documentation gaps:
1. Phase 2 (Config System) delivered a complete UAT (11/11 passed) and 4 SUMMARYs with `requirements-completed` frontmatter, but never produced a formal VERIFICATION.md. This leaves 19 CFG requirements without verification evidence.
2. The `.planning/REQUIREMENTS.md` M1 Gap Closure traceability table has `CFG-01–10 | Phase 8.2 | Pending` and `CFG-18–26 | Phase 8.2 | Pending` — these should be updated to Complete once the VERIFICATION.md is delivered.
3. `cli/CLAUDE.md` references deleted v1.x commands (`batch`, `schedule`, `listing`, `experiment` subcommands) and files (`batch.py`, `schedule.py`, `listing.py`, `lifecycle.py`) that no longer exist. The v2.0 CLI has only `run` and `config` commands.

### Evidence Sources for VERIFICATION.md

**Phase 2 SUMMARYs (requirements-completed frontmatter):**
- 02-01-SUMMARY: `[CFG-01, CFG-02, CFG-03, CFG-04, CFG-05, CFG-06, CFG-08, CFG-09, CFG-10]`
- 02-02-SUMMARY: `[CFG-07, CFG-18, CFG-19, CFG-20, CFG-21, CFG-22]`
- 02-03-SUMMARY: `[CFG-23, CFG-24, CFG-25, CFG-26]`
- 02-04-SUMMARY: `[CFG-02, CFG-03]` (additional introspection coverage)

**Phase 2 UAT (02-UAT.md — 11/11 passed):**
| UAT # | Covers |
|-------|--------|
| 1 | CFG-02, CFG-04 — v2.0 field names, construction |
| 2 | CFG-01 — extra=forbid rejects unknown fields |
| 3 | CFG-06, CFG-10 — backend configs None-as-default |
| 4 | CFG-09 — cross-validator (section mismatch) |
| 5 | CFG-18 — load_experiment_config() |
| 6 | CFG-20 — unknown keys produce ConfigError with did-you-mean |
| 7 | CFG-21, CFG-22 — XDG path, zero-config defaults |
| 8 | CFG-24, CFG-25 — env var overrides |
| 9 | CFG-26 — get_shared_params() introspection |
| 10 | CFG-26 — JSON schema export |
| 11 | CFG-18 — config/__init__.py public surface |

### Existing v2.0 CLI Files (from `ls src/llenergymeasure/cli/`)

```
cli/
├── __init__.py      # App setup — registers run + config commands only
├── run.py           # llem run command (v2.0 entry point)
├── config_cmd.py    # llem config command
├── _display.py      # Display helpers
├── _vram.py         # VRAM utilities
├── experiment.py    # DEAD CODE — v1.x experiment commands, not imported by __init__.py
├── config.py        # v1.x config commands (validate, generate-grid), not imported
├── results.py       # v1.x results commands, not imported
├── utils.py         # v1.x CLI utilities, not imported
└── display/         # Display utilities package (active — used by run.py)
```

### VERIFICATION.md Template

Use the Phase 8.1 VERIFICATION.md structure at `.planning/phases/08.1-pytorch-result-wiring-fixes/08.1-VERIFICATION.md` as the template. Key sections: frontmatter, Observable Truths, Required Artifacts, Requirements Coverage, Test Results, Verified Commits.

---

## Tasks

<task type="auto">
  <name>Write Phase 2 VERIFICATION.md</name>
  <files>.planning/phases/02-config-system/02-VERIFICATION.md</files>
  <action>
    Create `.planning/phases/02-config-system/02-VERIFICATION.md` following the Phase 8.1 template structure.

    **Frontmatter:**
    ```yaml
    ---
    phase: 02-config-system
    verified: {current ISO timestamp}
    status: passed
    score: 11/11 observable truths verified
    re_verification: false
    ---
    ```

    **Observable Truths (11, matching the 11 UAT tests):**

    Build the Observable Truths table with 11 entries — one per UAT test. Each truth maps to one or more CFG requirements. Use the UAT results (11/11 passed) and SUMMARY frontmatter as evidence.

    | # | Truth | Covers | Evidence Source |
    |---|-------|--------|----------------|
    | 1 | ExperimentConfig v2.0 imports and constructs with renamed fields (model, precision, n) | CFG-02, CFG-04 | UAT #1 pass; 02-01-SUMMARY |
    | 2 | ExperimentConfig rejects unknown fields with ValidationError (extra=forbid) | CFG-01 | UAT #2 pass; 02-01-SUMMARY |
    | 3 | Backend configs (PyTorchConfig etc.) default all fields to None | CFG-06, CFG-10 | UAT #3 pass; 02-01-SUMMARY |
    | 4 | Cross-validator rejects backend/section mismatch | CFG-09 | UAT #4 pass; 02-01-SUMMARY |
    | 5 | load_experiment_config(path) loads valid YAML into ExperimentConfig | CFG-18 | UAT #5 pass; 02-02-SUMMARY |
    | 6 | Unknown YAML keys produce ConfigError with did-you-mean suggestion | CFG-20 | UAT #6 pass; 02-02-SUMMARY |
    | 7 | UserConfig loads with XDG path and zero-config defaults | CFG-21, CFG-22 | UAT #7 pass; 02-03-SUMMARY |
    | 8 | Env var overrides (LLEM_RUNNER_PYTORCH) apply to UserConfig | CFG-24, CFG-25 | UAT #8 pass; 02-03-SUMMARY |
    | 9 | get_shared_params() returns v2.0 field names with backend_support | CFG-26 | UAT #9 pass; 02-04-SUMMARY |
    | 10 | get_experiment_config_schema() exports JSON schema with model/backend properties | CFG-26 | UAT #10 pass; 02-04-SUMMARY |
    | 11 | config/__init__.py exports clean v2.0 public surface | CFG-18 | UAT #11 pass; 02-04-SUMMARY |

    **Requirements Coverage table:**
    All 19 CFG requirements (CFG-01 through CFG-10, CFG-18 through CFG-26). For each, list the source plan (02-01 through 02-04), description, SATISFIED status, and evidence reference (which SUMMARY's `requirements-completed` list contains it + which UAT test covers it).

    Requirements not directly covered by a UAT test but listed in SUMMARY frontmatter:
    - CFG-03 (passthrough_kwargs) — 02-01-SUMMARY + 02-04-SUMMARY
    - CFG-05 (sub-configs: decoder, warmup, baseline) — 02-01-SUMMARY
    - CFG-07 (lora: LoRAConfig | None) — 02-02-SUMMARY
    - CFG-08 (PRECISION_SUPPORT/DECODING_SUPPORT in ssot.py) — 02-01-SUMMARY
    - CFG-19 (yaml.safe_load only) — 02-02-SUMMARY, code inspection
    - CFG-23 (UserConfig sections) — 02-03-SUMMARY

    **Required Artifacts:** List the 4 key files from the SUMMARYs:
    - `src/llenergymeasure/config/models.py` — ExperimentConfig v2.0 with extra=forbid
    - `src/llenergymeasure/config/loader.py` — load_experiment_config()
    - `src/llenergymeasure/config/user_config.py` — UserConfig, load_user_config()
    - `src/llenergymeasure/config/introspection.py` — get_shared_params(), get_experiment_config_schema()

    **Verified Commits:** Reference the SUMMARYs' completed dates (all 2026-02-26). Note: original commits are in the Phase 2 SUMMARY frontmatter; this is a retroactive verification, not a re-verification.

    **Test Results:** Reference UAT 11/11 passed. Also reference the unit test suite count at Phase 2 completion.
  </action>
  <verify>
    Read the created file and confirm:
    1. Frontmatter has `status: passed` and `score: 11/11`
    2. All 11 observable truths are present with VERIFIED status
    3. All 19 CFG requirements appear in the Requirements Coverage table with SATISFIED status
    4. No CFG requirement is missing
  </verify>
  <done>Phase 2 has a formal VERIFICATION.md confirming all 19 CFG requirements</done>
</task>

<task type="auto">
  <name>Update REQUIREMENTS.md traceability and fix cli/CLAUDE.md</name>
  <files>.planning/REQUIREMENTS.md, src/llenergymeasure/cli/CLAUDE.md</files>
  <action>
    **1. Update `.planning/REQUIREMENTS.md` traceability table:**

    Find the M1 Gap Closure traceability section (lines ~117-118) and change:
    ```
    | CFG-01–10 | Phase 8.2 | Pending | Verification gap — no VERIFICATION.md for Phase 2 |
    | CFG-18–26 | Phase 8.2 | Pending | Verification gap — no VERIFICATION.md for Phase 2 |
    ```
    To:
    ```
    | CFG-01–10 | Phase 8.2 | Complete | Verified — 02-VERIFICATION.md created with 11/11 truths |
    | CFG-18–26 | Phase 8.2 | Complete | Verified — 02-VERIFICATION.md created with 11/11 truths |
    ```

    **2. Correct `src/llenergymeasure/cli/CLAUDE.md`:**

    Replace the entire file content with an accurate v2.0 description. The v2.0 CLI has:
    - `__init__.py` — creates Typer app, registers `run` and `config` commands
    - `run.py` — `llem run` command (single experiment execution)
    - `config_cmd.py` — `llem config` command (environment display + setup guidance)
    - `_display.py` — display helpers for the active CLI
    - `_vram.py` — VRAM utility functions
    - `display/` — Rich console output package (console.py, tables.py, summaries.py, results.py)

    **Legacy files still present but NOT imported by v2.0 `__init__.py`:**
    - `experiment.py` — v1.x experiment commands (dead code, has broken imports)
    - `config.py` — v1.x config subcommands (validate, generate-grid)
    - `results.py` — v1.x results subcommands (list, show)
    - `utils.py` — v1.x CLI utilities

    **Remove all references to:**
    - `batch.py` (file does not exist)
    - `schedule.py` (file does not exist)
    - `listing.py` (file does not exist)
    - `lifecycle.py` (file does not exist)
    - The `batch`, `schedule`, `listing` command groups
    - `lem experiment` / `lem batch` / `lem schedule` / `lem results` / `lem datasets|presets|gpus` commands

    **v2.0 commands are:**
    - `llem run [config.yaml] [--model X] [--backend X]` — run experiment
    - `llem config [--verbose]` — show environment
    - `llem --version` — version flag
  </action>
  <verify>
    1. `grep -c "Pending" .planning/REQUIREMENTS.md` — should return fewer Pending entries than before (the CFG rows should now be Complete)
    2. `grep "batch.py\|schedule.py\|listing.py\|lifecycle.py\|lem batch\|lem schedule\|lem datasets" src/llenergymeasure/cli/CLAUDE.md` — should return no matches
    3. `grep "llem run\|llem config\|run.py\|config_cmd.py" src/llenergymeasure/cli/CLAUDE.md` — should return matches confirming v2.0 content
  </verify>
  <done>REQUIREMENTS.md traceability is current and cli/CLAUDE.md accurately reflects v2.0</done>
</task>

## Verification

After both tasks complete:

1. **VERIFICATION.md completeness:** `grep -c "SATISFIED" .planning/phases/02-config-system/02-VERIFICATION.md` returns 19 (one per CFG requirement)
2. **Traceability current:** `grep "CFG-01" .planning/REQUIREMENTS.md` shows "Complete", not "Pending"
3. **cli/CLAUDE.md accurate:** No references to deleted files or v1.x commands

## Success Criteria

- [ ] `.planning/phases/02-config-system/02-VERIFICATION.md` exists with `status: passed`, 11 observable truths, 19 requirements all SATISFIED
- [ ] `.planning/REQUIREMENTS.md` shows CFG-01–10 and CFG-18–26 as Complete
- [ ] `src/llenergymeasure/cli/CLAUDE.md` documents only v2.0 CLI commands and files

## Output

Plan produces 3 files:
- `.planning/phases/02-config-system/02-VERIFICATION.md` (NEW)
- `.planning/REQUIREMENTS.md` (MODIFIED — 2 rows updated)
- `src/llenergymeasure/cli/CLAUDE.md` (MODIFIED — rewritten for v2.0)
