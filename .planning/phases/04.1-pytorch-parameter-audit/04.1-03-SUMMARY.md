---
phase: 04.1-pytorch-parameter-audit
plan: 03
subsystem: config
tags: [pytorch, ssot, introspection, tests, metadata]
dependency_graph:
  requires: [04.1-01, 04.1-02]
  provides: [ssot-complete, backend-config-tests-v2]
  affects: [tests/unit/test_config_backend_configs.py]
tech_stack:
  added: []
  patterns: [ssot-introspection, none-as-default, cross-validators]
key_files:
  created: []
  modified:
    - src/llenergymeasure/config/ssot.py
    - src/llenergymeasure/config/introspection.py
    - tests/unit/test_config_backend_configs.py
decisions:
  - "flash_attention_3 placed in Hopper-required tier (compute capability 9.0+) — distinct from Ampere tier"
  - "Validation rules count expanded to 8 total — 3 new PyTorchConfig cross-validator rules added"
  - "Test file fully rewritten (51 tests) rather than incremental update — v1.x class references were too numerous to patch"
metrics:
  duration: ~2 min
  completed_date: "2026-02-26"
  tasks_completed: 2
  files_modified: 3
---

# Phase 4.1 Plan 03: PyTorch Parameter Audit - SSOT Update and Test Rewrite Summary

**One-liner:** SSOT metadata files updated for expanded PyTorchConfig (22 params, 8 validation rules, 4 new capabilities); test file fully rewritten for v2.0 with 51 passing tests.

## What Was Built

Closed the loop on the Phase 4.1 audit: the SSOT metadata layer (`ssot.py`, `introspection.py`) now accurately reflects the expanded PyTorchConfig from Plan 01, and the unit test file has been fully rewritten from v1.x to v2.0 schema.

### Task 1 — Update SSOT metadata files

**Commit:** `a850440`
**Files:** `src/llenergymeasure/config/ssot.py`, `src/llenergymeasure/config/introspection.py`

**ssot.py:**
- `DECODER_PARAM_SUPPORT["pytorch"]` now includes `min_p` and `min_new_tokens`

**introspection.py — 6 function updates:**

| Function | Change |
|----------|--------|
| `get_backend_specific_params()` | pytorch list expanded from 6 to 22 field paths |
| `get_mutual_exclusions()` | Added torch_compile_mode, torch_compile_backend, bnb_4bit_*, cache_implementation entries |
| `get_param_skip_conditions()` | Added flash_attention_3, torch_compile=True, bnb_4bit_*, prompt_lookup_num_tokens |
| `get_params_requiring_gpu_capability()` | Added Hopper tier (9.0+) with flash_attention_3 |
| `get_validation_rules()` | Added 3 new rules: torch_compile_mode, bnb_4bit_*, cache_implementation (8 rules total) |
| `get_backend_capabilities()` | Added torch_compile, beam_search, speculative_decoding, static_kv_cache entries |
| `get_capability_matrix_markdown()` | Added display names for 4 new capabilities |

### Task 2 — Rewrite unit tests for v2.0 backend configs

**Commit:** `0352cd8`
**File:** `tests/unit/test_config_backend_configs.py`

Complete rewrite removing 769 lines of v1.x tests and replacing with 456 lines of v2.0 tests (51 tests, all passing).

| Test Class | Tests | Coverage |
|------------|-------|---------|
| `TestPyTorchConfig` | 18 | All 20 fields, Literal values, constraints, `extra="forbid"` |
| `TestPyTorchConfigCrossValidators` | 13 | All 4 validators, valid/invalid combos |
| `TestDecoderConfigNewFields` | 6 | min_p and min_new_tokens fields |
| `TestVLLMConfig` | 4 | v2.0 minimal schema defaults and quantization |
| `TestTensorRTConfig` | 4 | v2.0 minimal schema defaults and quantization |
| `TestExperimentConfigBackendIntegration` | 6 | Backend sections, serialization roundtrip |

**Removed v1.x imports:** `PyTorchAssistedGenerationConfig`, `VLLMAttentionConfig`, `VLLMSpeculativeConfig`, `VLLMLoRAConfig`, `TensorRTCalibrationConfig` — none exist in v2.0.

## Decisions Made

1. **flash_attention_3 in Hopper (9.0+) tier** — Separate from the Ampere (8.0+) tier. `get_params_requiring_gpu_capability(9.0)` now returns both ampere + hopper params; lower thresholds return ampere only. This mirrors the GPU capability ladder accurately.

2. **Validation rules count = 8** — Original 5 rules preserved; 3 new PyTorchConfig cross-validator rules added. The function documents all model-level validators (not just field-level Literal constraints).

3. **Full test rewrite** — v1.x class imports were pervasive across the old test file (5 removed classes, 769 lines). Incremental patching would leave structural confusion. Complete replacement is cleaner and produces a canonical v2.0 test file.

## Deviations from Plan

None — plan executed exactly as written.

## Verification Results

All 8 plan verification checks passed:

1. `DECODER_PARAM_SUPPORT["pytorch"]` includes "min_p" and "min_new_tokens"
2. `get_backend_specific_params()["pytorch"]` lists exactly 22 field paths
3. `get_mutual_exclusions()` includes torch_compile_mode, bnb_4bit_compute_dtype, cache_implementation
4. `get_param_skip_conditions()` includes flash_attention_3, torch_compile=True, bnb_4bit_* entries
5. `get_validation_rules()` has 8 rules (3 new: torch_compile_mode, bnb_4bit_*, cache_implementation)
6. `get_backend_capabilities()` includes torch_compile, beam_search, speculative_decoding, static_kv_cache
7. `pytest tests/unit/test_config_backend_configs.py` — 51 passed, 0 failed, 0 v1.x imports
8. No import errors from stale v1.x class references

## Self-Check: PASSED

Files modified exist:
- `src/llenergymeasure/config/ssot.py` — FOUND
- `src/llenergymeasure/config/introspection.py` — FOUND
- `tests/unit/test_config_backend_configs.py` — FOUND

Commits exist:
- `a850440` — FOUND (feat(config): update SSOT metadata)
- `0352cd8` — FOUND (test(config): rewrite backend config tests for v2.0)
