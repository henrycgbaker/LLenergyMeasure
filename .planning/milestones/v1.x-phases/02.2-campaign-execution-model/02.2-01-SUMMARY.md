---
phase: "02.2"
plan: "01"
subsystem: campaign-execution
tags: [environment-variables, cli, context-propagation]

dependency-graph:
  requires: ["02-campaign-orchestrator"]
  provides: ["campaign-context-propagation", "experiment-cli-simplification"]
  affects: ["02.2-02", "02.2-03", "02.2-04"]

tech-stack:
  patterns: ["environment-variable-context", "subprocess-env-propagation"]

key-files:
  created: []
  modified:
    - src/llenergymeasure/cli/campaign.py
    - src/llenergymeasure/cli/experiment.py
    - src/llenergymeasure/orchestration/launcher.py

decisions:
  - id: "02.2-01-01"
    title: "Environment variables for campaign context"
    choice: "LEM_CAMPAIGN_ID, LEM_CAMPAIGN_NAME, LEM_CYCLE, LEM_TOTAL_CYCLES"
    rationale: "Standard Unix pattern for cross-process context; works with both Docker -e and local subprocess"
  - id: "02.2-01-02"
    title: "Remove --cycles from experiment CLI"
    choice: "Experiments are atomic; campaigns own repetition"
    rationale: "Clearer separation of concerns; avoids confusion about what controls cycles"

metrics:
  duration: "3 min"
  completed: "2026-02-03"
---

# Phase 02.2 Plan 01: Campaign Context Propagation Summary

Campaign context (ID, name, cycle, total cycles) flows to experiments via environment variables; CI warnings suppressed for campaign experiments; --cycles flag removed from experiment CLI.

## What Was Built

### Campaign Context Environment Variables
- `_run_single_experiment()` now builds campaign context dict with LEM_CAMPAIGN_ID, LEM_CAMPAIGN_NAME, LEM_CYCLE, LEM_TOTAL_CYCLES
- Docker execution passes context via `-e` flags in docker compose run command
- Local execution passes context via `env.update(campaign_context)`

### Experiment CLI Campaign Detection
- Detects campaign context from environment variables at startup
- Displays "Part of campaign X (cycle Y/Z)" instead of single cycle warning when in campaign
- Removed `--cycles` CLI flag (experiments are atomic, campaigns own repetition)
- Updated docstring to reference campaigns for multi-cycle experiments

### Launcher Campaign Logging
- Logs campaign context (name, cycle, total) when LEM_CAMPAIGN_ID is set
- Provides traceability in experiment logs for campaign runs

## Deviations from Plan

None - plan executed exactly as written. campaign.py changes were already committed in a prior execution (commits 814d3d4, 02e80b6 for plan 02.2-02), so only experiment.py and launcher.py changes were committed in this execution.

## Commits

| Hash | Message | Files |
|------|---------|-------|
| 0fcbd6c | feat(02.2-01): propagate campaign context to experiments | experiment.py, launcher.py |

Note: campaign.py changes were committed as part of 02.2-02 execution (814d3d4).

## Verification Results

1. Ruff check: All checks passed
2. Ruff format: 3 files left unchanged (already formatted)
3. --cycles flag removed: `python -c "..." | grep cycle` returns only docstring reference to campaigns
4. LEM_CAMPAIGN_* env vars: Present in campaign.py (lines 790-793), experiment.py (line 651), launcher.py (line 734)

## Next Steps

Plan 02.2-02 (User Config and Container Routing) was already executed. Proceed to 02.2-03 (Backend Auto-Detection and Image Builds).
