---
phase: 02-campaign-orchestrator
plan: 07
type: execute
wave: 3
depends_on: ["02-01"]
files_modified:
  - src/llenergymeasure/config/introspection.py
autonomous: true

must_haves:
  truths:
    - "SSOT introspection auto-discovers all new Phase 2 CampaignConfig fields"
    - "get_campaign_params() returns all campaign config parameters with metadata"
    - "Generated docs include Phase 2 campaign config parameters"
    - "Runtime validation tests can discover Phase 2 parameters"
  artifacts:
    - path: "src/llenergymeasure/config/introspection.py"
      provides: "get_campaign_params() function for campaign config introspection"
      contains: "def get_campaign_params"
  key_links:
    - from: "src/llenergymeasure/config/introspection.py"
      to: "src/llenergymeasure/config/campaign_config.py"
      via: "introspects CampaignConfig Pydantic model"
      pattern: "CampaignConfig|CampaignGridConfig|CampaignHealthCheckConfig"
---

<objective>
Thread Phase 2 campaign config extensions through SSOT introspection so they appear in CLI outputs, generated docs, and runtime validation tests.

Purpose: Success criteria 10 — all config extensions threaded through SSOT introspection. The existing introspection module auto-discovers ExperimentConfig fields; this extends it to also discover CampaignConfig fields for campaign-specific documentation and validation.
Output: Extended introspection.py with campaign config awareness.
</objective>

<execution_context>
@/home/h.baker@hertie-school.lan/.claude/get-shit-done/workflows/execute-plan.md
@/home/h.baker@hertie-school.lan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-campaign-orchestrator/02-01-SUMMARY.md
@src/llenergymeasure/config/introspection.py
@src/llenergymeasure/config/campaign_config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add campaign config introspection functions</name>
  <files>src/llenergymeasure/config/introspection.py</files>
  <action>
Add campaign config introspection functions to the existing introspection.py. Do NOT modify any existing functions — this is purely additive. Add new functions at the bottom of the file (before `__all__` if it exists).

**New functions to add:**

1. `get_campaign_params() -> dict[str, dict[str, Any]]`:
   - Introspects `CampaignConfig` and all nested models (CampaignGridConfig, CampaignHealthCheckConfig, CampaignColdStartConfig, CampaignDaemonConfig, CampaignIOConfig, CampaignExecutionConfig, CampaignScheduleConfig)
   - Returns dict mapping param path (e.g., "grid.backends", "health_check.gpu_memory_threshold_pct") to metadata dict
   - Reuses existing `_extract_param_metadata()` helper to get type, default, description, constraints
   - Recursively introspects nested BaseModel fields (e.g., `grid` field is CampaignGridConfig, so extract its sub-fields)

2. `get_campaign_grid_params() -> dict[str, dict[str, Any]]`:
   - Subset of get_campaign_params() that returns only grid-related fields
   - Used by campaign grid validation to report available grid axes

3. `get_campaign_health_check_params() -> dict[str, dict[str, Any]]`:
   - Subset for health check config fields

**Implementation approach:**
- Import the campaign config models lazily inside the functions (to avoid circular imports)
- Follow the same pattern as `get_backend_params()` which introspects backend config Pydantic models
- Use `_extract_param_metadata()` for each field, passing the appropriate prefix
- For nested models: check if field annotation is a BaseModel subclass, if so recurse with prefix

**Update `__all__`** (if it exists) to include new functions.

**Important:**
- Look at how existing functions like `get_backend_params()` and `get_shared_params()` work in the file
- Follow the exact same patterns for campaign introspection
- The existing `_extract_param_metadata()` helper should work for campaign fields too since they're all standard Pydantic fields
  </action>
  <verify>
    python -c "
from llenergymeasure.config.introspection import (
    get_campaign_params,
    get_campaign_grid_params,
    get_campaign_health_check_params,
)

# Test campaign params discovery
params = get_campaign_params()
assert len(params) > 0, 'No campaign params found'
print(f'Total campaign params: {len(params)}')

# Check key params are discovered
param_names = set(params.keys())
# Should find grid-related params
assert any('grid' in p for p in param_names), f'No grid params found in: {param_names}'
# Should find health check params
assert any('health_check' in p for p in param_names), f'No health_check params in: {param_names}'
# Should find cold start params
assert any('cold_start' in p for p in param_names), f'No cold_start params in: {param_names}'
# Should find IO params
assert any('io' in p for p in param_names), f'No io params in: {param_names}'

print(f'Sample params: {list(param_names)[:10]}')

# Test grid-specific params
grid_params = get_campaign_grid_params()
assert len(grid_params) > 0
assert any('backends' in p for p in grid_params)
print(f'Grid params: {len(grid_params)}')

# Test health check params
hc_params = get_campaign_health_check_params()
assert len(hc_params) > 0
assert any('gpu_memory_threshold' in p for p in hc_params)
print(f'Health check params: {len(hc_params)}')

print('All SSOT introspection tests passed')

# Also verify existing doc gen scripts still work (non-blocking)
import subprocess, sys
result = subprocess.run(
    [sys.executable, 'scripts/generate_invalid_combos_doc.py'],
    capture_output=True, text=True, cwd='/home/h.baker@hertie-school.lan/workspace/llm-efficiency-measurement-tool'
)
if result.returncode == 0:
    print('Doc generation scripts still work')
else:
    print(f'Doc gen script returned {result.returncode} (may need GPU context - non-blocking)')
"
  </verify>
  <done>SSOT introspection auto-discovers all Phase 2 campaign config fields. Campaign params accessible via get_campaign_params() for docs, CLI, and validation.</done>
</task>


</tasks>

<verification>
- `python -c "from llenergymeasure.config.introspection import get_campaign_params"` succeeds
- Campaign params discovered: grid, health_check, cold_start, daemon, io fields
- Existing introspection functions unchanged and still work
- `ruff check src/llenergymeasure/config/introspection.py` passes
- Existing tests pass: `pytest tests/ -x -q -k introspection`
</verification>

<success_criteria>
- get_campaign_params() returns all Phase 2 config fields with metadata
- Follows existing SSOT patterns (reuses _extract_param_metadata)
- No modifications to existing functions
- Doc generation scripts still work
</success_criteria>

<output>
After completion, create `.planning/phases/02-campaign-orchestrator/02-07-SUMMARY.md`
</output>
