---
phase: 02.3-campaign-state-resume
task: cycles-refactor
total_tasks: 3
status: in_progress
last_updated: 2026-02-04T14:00:00Z
---

<current_state>
Major refactor in progress: removing experiment-level cycles, making experiments atomic.
Phase A (removal) is COMPLETE. Phase B (campaign enhancements) needs implementation.
</current_state>

<completed_work>

## Phase A: Remove experiment-level cycles ✅ COMPLETE

All experiment-level cycles functionality has been removed:

1. **ExperimentConfig** (`config/models.py`):
   - Removed `num_cycles` field
   - Removed `cycle_id` field

2. **Domain models** (`domain/experiment.py`):
   - Removed `CycleStatistics` class
   - Removed `CycleMetadata` class
   - Removed `MultiCycleResult` class
   - Removed `cycle_run_info` field from `RawProcessResult`

3. **CLI** (`cli/experiment.py`):
   - Removed cycle loop — experiments now run once (atomic)
   - Simplified `_display_measurement_summary()` signature
   - Removed `CycleProgress` import and usage

4. **Results module** (`results/`):
   - Deleted `cycle_statistics.py` module entirely
   - Module handled experiment-level stats — campaigns will own this

5. **Progress module** (`progress.py`):
   - Removed `CycleProgress` class

6. **Display** (`cli/display/summaries.py`):
   - Removed `num_cycles` references from config display

7. **Config docs** (`config/naming.py`, `config/README.md`):
   - Removed `num_cycles` naming entry
   - Updated README examples

8. **Tests**:
   - Deleted `test_cycle_statistics.py`

**Test status**: 987 unit tests pass ✅

</completed_work>

<remaining_work>

## Phase B: Campaign-level enhancements

### B1. Add shuffle_within_cycle option
File: `config/campaign_config.py`
- Add `shuffle_within_cycle: bool = False` to `CampaignExecutionConfig`
- Update campaign runner to respect this option

### B2. Add group_by for aggregation
File: `config/campaign_config.py`
- Add `group_by: list[str] | None = None` to `CampaignConfig`
- Default: group by experiment config (existing behaviour)
- Options: model, backend, or list of fields

### B3. Implement shuffling in campaign runner
File: `orchestration/campaign.py` or `cli/campaign.py`
- When `shuffle_within_cycle=True`, randomise experiment order within each cycle
- Preserve cycle boundaries (all experiments in cycle 1, then cycle 2, etc.)

### B4. Implement configurable aggregation
File: `results/` (new module or extension)
- Move cycle_statistics logic here (campaign-level stats)
- Support group_by dimensions

## Phase C: Cleanup

- Update example campaign configs
- Update any remaining docs
- Final test pass

</remaining_work>

<decisions_made>

1. **Experiments are atomic**: Single execution, no internal cycles. Campaign owns all scheduling.

2. **Cycles functionality preserved at campaign level**: Campaign orchestrator already has cycle support via `execution.cycles`.

3. **Shuffle within cycles**: New option to randomise experiment order (reduces systematic bias from thermal patterns).

4. **Aggregation dimensions**: Group by experiment config (default) or by model/backend for cross-config analysis.

</decisions_made>

<blockers>
None. Phase A complete, ready for Phase B implementation.
</blockers>

<context>
This refactor was requested to simplify the architecture:
- Experiments: atomic single-run units
- Campaigns: own all scheduling, cycles, shuffling, aggregation

The change follows single-responsibility principle and makes reasoning about results simpler.
</context>

<next_action>
1. Implement Phase B: Campaign-level enhancements
2. Add `shuffle_within_cycle` and `group_by` to campaign config
3. Update campaign runner to support shuffling
4. Add campaign-level statistics aggregation
5. Update docs and commit
</next_action>
