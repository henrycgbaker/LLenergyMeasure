---
phase: 02.1-zero-config-install
task: 0
total_tasks: 6 plans (15 tasks total)
status: planned (not yet executing)
last_updated: 2026-01-30T01:45:00
---

<current_state>
Phase 2.1 planning is COMPLETE. All 6 plans written, verified by plan-checker (passed on iteration 2 after fixing 2 blockers + 1 warning). No execution has started yet.

Phase 2 execution is at 7/8 plans complete (02-08 unit tests + UAT still pending). Phase 2.1 was inserted as urgent work discovered during Phase 2 UAT.
</current_state>

<completed_work>

**This session (planning only):**
- Research: 02.1-RESEARCH.md — Docker detection, backend detection, env setup, Typer nested commands, Poetry extras
- Context: 02.1-CONTEXT.md — 8 architectural decisions from user discussion (local-first, PyTorch default, three install paths, lem docker subcommands, .env scope, setup.sh removal)
- Plan 02.1-01: Detection modules (docker_detection, backend_detection, env_setup) — Wave 1
- Plan 02.1-02: CLI wiring (lem docker setup/status/build, lem backend list) — Wave 2
- Plan 02.1-06: Campaign refactor (_should_use_docker + ensure_env_file wiring) — Wave 2
- Plan 02.1-03: Packaging (PyTorch default, Makefile, delete setup.sh, PyPI validation) — Wave 3
- Plan 02.1-04: Documentation refresh (README, quickstart, backends, deployment) — Wave 3
- Plan 02.1-05: Unit tests + UAT verification checkpoint — Wave 4
- Plan checker: Passed on iteration 2 (fixed PyPI validation gap, split complex task, clarified .env insertion points)
- ROADMAP.md: Updated with final 6-plan structure

**Prior sessions (Phase 2 execution):**
- Plans 02-01 through 02-07 executed (campaign config, ContainerManager, bootstrap CI, manifest, grid expansion, orchestrator integration, SSOT introspection)
- Plan 02-08 (unit tests + UAT) not yet executed
</completed_work>

<remaining_work>

**Immediate next: Execute Phase 2.1**
All 6 plans ready for execution in 4 waves:

| Wave | Plans | What |
|------|-------|------|
| 1 | 02.1-01 | Detection modules (3 new files in config/) |
| 2 | 02.1-02 + 02.1-06 | CLI subcommands + campaign.py refactor (parallel) |
| 3 | 02.1-03 + 02.1-04 | Packaging + docs refresh (parallel) |
| 4 | 02.1-05 | Unit tests + UAT checkpoint (human verify) |

**Then: Finish Phase 2**
- Plan 02-08 still pending (unit tests + UAT round 2 for campaign orchestrator)

**Then: Phases 3 and 4**
- Phase 3: Parameter Completeness (not yet planned)
- Phase 4: Polish + UAT (not yet planned)
</remaining_work>

<decisions_made>

- Local-first execution model: pip install gives working tool immediately, Docker opt-in for multi-backend campaigns
- PyTorch as default backend in core dependencies (not optional extra)
- Three install paths: local (pip), local+Docker (pip + lem docker setup), Docker-only (make docker-setup)
- setup.sh deleted entirely — replaced by pip install + lem docker setup + make docker-setup
- .env contains PUID/PGID only (no HF_TOKEN) — auto-generated on first Docker use, never overwritten
- First-run detection over post-install hooks (editable installs don't trigger setuptools hooks)
- Multi-method Docker detection (/.dockerenv + /proc/1/cgroup) for robustness
- Campaign refactor split into dedicated plan (02.1-06) for maintainability
- PyPI validation added to Plan 02.1-03 (poetry build + wheel install test)
</decisions_made>

<blockers>
None. All plans verified and ready for execution.
</blockers>

<context>
Phase 2.1 was inserted as urgent work after Phase 2 UAT revealed that `_should_use_docker()` was broken (always returned False), `.env` required manual `setup.sh`, and conda installs were misidentified as needing Docker.

The phase is about developer experience — making `pip install` work out of the box. It's refactoring + CLI additions, no new dependencies needed. All libraries (python-dotenv, Typer, python-on-whales) already in the project.

Key files to understand:
- `src/llenergymeasure/cli/campaign.py` — contains the broken `_should_use_docker()` at lines ~856-878
- `src/llenergymeasure/cli/__init__.py` — where new subcommands get registered
- `pyproject.toml` — packaging config, extras need restructuring
- `setup.sh` — to be deleted
</context>

<next_action>
Run: `/gsd:execute-phase 2.1`

This will execute all 6 plans in wave order. Clear context first (`/clear`) for a fresh window.
</next_action>
